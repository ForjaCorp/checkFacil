# üéâ CheckFacil - Backend API

Sistema de gest√£o de festas infantis do **Espa√ßo Criar**, respons√°vel por:
- L√≥gica de neg√≥cios
- Autentica√ß√£o via JWT
- Gest√£o de festas, clientes e convidados
- Integra√ß√µes com webhooks (n8n)

---

## üõ†Ô∏è Tecnologias Utilizadas

- **Node.js** ‚Äì Ambiente de execu√ß√£o JavaScript
- **Express.js** ‚Äì Framework para cria√ß√£o de APIs
- **Sequelize** ‚Äì ORM para MySQL
- **MySQL** ‚Äì Banco de dados relacional
- **JWT** ‚Äì Autentica√ß√£o de rotas
- **Axios** ‚Äì Requisi√ß√µes HTTP (ex: integra√ß√£o com n8n)
- **CORS** ‚Äì Libera√ß√£o de origens para o frontend
- **dotenv** ‚Äì Vari√°veis de ambiente
- **bcryptjs** ‚Äì Hash seguro de senhas
- **Yarn Workspaces** ‚Äì Monorepo

---

## ‚öôÔ∏è Configura√ß√£o do Ambiente

### ‚úîÔ∏è Pr√©-requisitos

- Node.js `v22.x` ou superior  
- Yarn `v4.x` ou superior  
- Banco de dados MySQL ativo  

### üì¶ Instala√ß√£o

```bash
yarn install
```

### üîê Vari√°veis de Ambiente

Crie um arquivo `.env` na pasta `/server` com:

```env
# Banco de Dados
DB_HOST=localhost
DB_USER=seu_usuario_mysql
DB_PASSWORD=sua_senha_mysql
DB_NAME=checkfacil_db
DB_PORT=3306

# JWT
JWT_SECRET=gere_um_segredo_forte_e_aleatorio_aqui

# Porta do Servidor
PORT=3001
```

---

## üöÄ Execu√ß√£o do Projeto

Modo desenvolvimento (somente o backend):

```bash
yarn dev:server
```

Frontend + Backend juntos:

```bash
yarn dev
```

A API estar√° dispon√≠vel em: [http://localhost:3001](http://localhost:3001)

---

## üîê Endpoints de Autentica√ß√£o (`/auth`)

> Todas as rotas relacionadas ao login e cadastro de usu√°rios (admin e convidados).

| M√©todo | Rota                          | Descri√ß√£o                                                |
|--------|-------------------------------|----------------------------------------------------------|
| POST   | `/auth/register/convidado`    | Registra um novo convidado no sistema                    |
| POST   | `/auth/register/admEspaco`    | Registra um novo administrador do espa√ßo                 |
| POST   | `/auth/register/admFesta`     | Registra um novo administrador de festa                  |
| POST   | `/auth/login`                 | Realiza login e retorna token JWT                        |
| POST   | `/auth/definir-senha`         | Permite defini√ß√£o de senha via token de primeiro acesso  |

#### üî∏ Exemplo: Login

```json
{
  "email": "admin@exemplo.com",
  "senha": "senha_forte_aqui"
}
```

#### üî∏ Exemplo: Definir Senha

```json
{
  "token": "token_de_uso_unico_enviado_no_link",
  "novaSenha": "nova_senha_forte"
}
```

---

## üéâ Endpoints de Festas (`/festa`)

üîê Requer autentica√ß√£o via token JWT.

| M√©todo | Rota               | Descri√ß√£o                                      |
|--------|--------------------|-----------------------------------------------|
| POST   | `/festa/criar`     | Cria uma nova festa e associa um cliente      |
| GET    | `/festa/listar`    | Lista festas com filtros e permiss√µes         |
| PATCH  | `/festa/:idFesta`  | Atualiza uma festa espec√≠fica                 |
| DELETE | `/festa/:idFesta`  | Remove uma festa do sistema                   |

### üîç Filtros dispon√≠veis em `/festa/listar`

- `?data=2025-12-25` ‚Üí por data exata  
- `?data_inicio=2025-12-01&data_fim=2025-12-31` ‚Üí por intervalo de datas  

---

## üßë‚Äçü§ù‚Äçüßë Endpoints de Convidados (`/festa/:idFesta/convidados`)

> Gerenciamento de convidados vinculados a uma festa. Requer autentica√ß√£o JWT.

| M√©todo | Rota                                                                 | Descri√ß√£o                            |
|--------|----------------------------------------------------------------------|--------------------------------------|
| POST   | `/festa/:idFesta/convidados`                                         | Adiciona um novo convidado √† festa   |
| GET    | `/festa/:idFesta/convidados`                                         | Lista todos os convidados da festa   |
| GET    | `/festa/:idFesta/convidados/buscar?nome=Jo√£o`                        | Busca convidados pelo nome           |
| PATCH  | `/festa/:idFesta/convidados/:idConvidado`                            | Atualiza um convidado espec√≠fico     |
| DELETE | `/festa/:idFesta/convidados/:idConvidado`                            | Remove um convidado espec√≠fico       |

#### üî∏ Exemplo: Adicionar Convidado

```json
{
  "nome_convidado": "Jo√£o da Silva",
  "tipo_convidado": "ADULTO_PAGANTE",
  "idade_convidado": 30,
  "nome_responsavel": null,
  "telefone_responsavel": null
}
```

---

## ‚úÖ Observa√ß√µes T√©cnicas

- **Todas as rotas de `/festa` e `/festa/:idFesta/convidados` s√£o protegidas com JWT**.
- **Middlewares** utilizados:
  - `verificarTokenJWT`: para rotas protegidas
  - `validarRegistro`, `validarLogin`: valida√ß√£o de corpo de requisi√ß√£o em cadastros/login
- Os registros de administrador (`admEspaco`, `admFesta`) devem ser protegidos em produ√ß√£o.
